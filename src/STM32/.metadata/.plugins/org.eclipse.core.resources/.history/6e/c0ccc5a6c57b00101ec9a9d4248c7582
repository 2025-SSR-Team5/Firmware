/*
 * connection.c
 *
 *  Created on: Aug 15, 2025
 *      Author: takeu
 */

#include "initial_operation.h"
extern I2C_HandleTypeDef hi2c1;

HAL_StatusTypeDef do_instruction(uint8_t devstat){
	uint8_t instruction;
	HAL_StatusTypeDef result = HAL_ERROR;

	if(HAL_I2C_Slave_Receive(&hi2c1,&instruction, 1, HAL_MAX_DELAY) == HAL_OK){
		HAL_GPIO_TogglePin(GPIOA, GPIO_PIN_8);
		switch (instruction){
		case 0x00 :
			// デバイス情報を渡す
			result = Check_I2C_to_ESP32(devstat);
			if(result != HAL_OK){
				HAL_GPIO_TogglePin(GPIOA, GPIO_PIN_11);
			}else{
				HAL_GPIO_TogglePin(GPIOA, GPIO_PIN_12);
			}
			break;
		case 0x01 :
			//ここにステッピングモーターの制御を記述
			break;
		default:
			break;
		}
	}

	return result;
}
